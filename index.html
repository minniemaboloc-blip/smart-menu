<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Menu</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
#overlay { background: rgba(0,0,0,.6); }
</style>
</head>

<body class="bg-gray-100 pb-36">

<script>
const FB_PAGE = "minchis.dvo"; // your FB page username
const SHEET_ID = "1ufX4XtO7L4q5BjyeSYWxR-B8MxTCYJ3IMSr2PFZQQ6U";
const SHEET_NAME = "Menu";

let order = {};
let cartQty = 0;
let cartTotal = 0;
let orderType = "Dine-In";
</script>

<div class="max-w-3xl mx-auto p-4">

<!-- LOGO -->
<div class="text-center mb-3">
<img src="https://scontent.fdvo2-1.fna.fbcdn.net/v/t39.30808-6/593889522_1298553832312180_3090718135975847774_n.jpg?_nc_cat=103&ccb=1-7&_nc_sid=1d70fc&_nc_eui2=AeEng1zQxTfdOstiNQQozLTR5sGA_J-CHlXmwYD8n4IeVTYQpTbypAkY9mZ9ALpKJ8gaTO9o2OheiUF3igscfpaE&_nc_ohc=4us7rTv4LgAQ7kNvwHodt0H&_nc_oc=Adl781F231UBRo7EQvX_kOt5TYWMmFHVeAOragi1cL-xzPu3_nEHnU8-zzA7yVkAbsM&_nc_zt=23&_nc_ht=scontent.fdvo2-1.fna&_nc_gid=ueE5FPz0S_9-82wJMA1aNA&oh=00_Afs1leajMlbaOAlOoRNmTqFgpergZSpEqgVM3EDbs-GxAQ&oe=699ADF25"
class="h-16 mx-auto">
</div>

<h1 class="text-xl font-bold text-center mb-4">Minchi's Smart Menu</h1>

<!-- ORDER TYPE -->
<div class="bg-white p-4 rounded-xl shadow mb-4">
<p class="font-semibold mb-2">Order Type</p>
<div class="flex gap-2">
<button onclick="setOrderType(this,'Dine-In')" class="typeBtn bg-red-600 text-white px-4 py-2 rounded-xl">Dine-In</button>
<button onclick="setOrderType(this,'Take-Out')" class="typeBtn bg-gray-200 px-4 py-2 rounded-xl">Take-Out</button>
<button onclick="setOrderType(this,'Delivery')" class="typeBtn bg-gray-200 px-4 py-2 rounded-xl">Delivery</button>
</div>
</div>

<!-- MENU -->
<div id="menu"></div>
</div>

<!-- CART BAR -->
<div id="cartBar"
class="fixed bottom-0 left-0 right-0 bg-white border-t shadow-lg p-4 flex justify-between items-center hidden"
onclick="openSummary()">
<div>
<p class="font-semibold">ðŸ›’ <span id="cartQty">0</span> item(s)</p>
<p class="text-sm">â‚±<span id="cartTotal">0</span></p>
</div>
<button class="bg-red-600 text-white px-6 py-2 rounded-xl font-semibold">
Order
</button>
</div>

<!-- SUMMARY MODAL -->
<div id="overlay" class="fixed inset-0 hidden flex items-end z-50">
<div class="bg-white w-full rounded-t-2xl p-5 max-h-[80%] overflow-y-auto">
<h2 class="text-lg font-bold mb-3">Order Summary</h2>
<div id="summary"></div>

<button onclick="sendToMessenger()"
class="mt-4 w-full bg-blue-600 text-white py-3 rounded-xl font-semibold">
Send Order via Messenger
</button>

<button onclick="closeSummary()" class="mt-2 w-full text-gray-500">Cancel</button>
</div>
</div>

<!-- IMAGE PREVIEW -->
<div id="imgModal"
class="fixed inset-0 hidden bg-black bg-opacity-70 flex items-center justify-center z-50"
onclick="this.classList.add('hidden')">
<img id="imgView" class="max-h-[90%] max-w-[90%] rounded-xl">
</div>

<script>
async function loadMenu(){
const url=`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?sheet=${SHEET_NAME}&tqx=out:json`;
const res=await fetch(url);
const txt=await res.text();
const json=JSON.parse(txt.substring(txt.indexOf("{"),txt.lastIndexOf("}")+1));
const rows=json.table.rows;

let menu={},id=1;
rows.forEach(r=>{
if(!r.c[0])return;
let item={
id:id++,
cat:r.c[0].v,
name:r.c[1].v,
price:Number(r.c[2].v),
img:r.c[5]?.v||""
};
(menu[item.cat]=menu[item.cat]||[]).push(item);
});
renderMenu(menu);
}

function renderMenu(menu){
const wrap=document.getElementById("menu");
wrap.innerHTML="";
Object.keys(menu).forEach(cat=>{
const sec=document.createElement("div");
sec.className="mb-4";
sec.innerHTML=`
<button class="catBtn w-full bg-white p-4 rounded-xl shadow font-bold flex justify-between"
onclick="toggleCat(this)">
${cat}<span>â–¾</span>
</button>
<div class="grid grid-cols-2 gap-4 mt-3 hidden"></div>`;
const grid=sec.querySelector(".grid");

menu[cat].forEach(i=>{
grid.innerHTML+=`
<div class="bg-white rounded-xl shadow overflow-hidden">
<div class="relative">
<img src="${i.img}" class="h-32 w-full object-cover"
onclick="showImg('${i.img}')">
<button onclick="addItem(${i.id},'${i.name}',${i.price})"
class="absolute bottom-2 right-2 bg-green-600 text-white w-10 h-10 rounded-full text-xl">+</button>
</div>
<div class="p-3">
<p class="font-semibold text-sm">${i.name}</p>
<p class="font-bold">â‚±${i.price}</p>
</div>
</div>`;
});
wrap.appendChild(sec);
});
}

function toggleCat(btn){
document.querySelectorAll(".catBtn").forEach(b=>{
if(b!==btn){
b.nextElementSibling.classList.add("hidden");
b.querySelector("span").innerText="â–¾";
}});
const g=btn.nextElementSibling;
g.classList.toggle("hidden");
btn.querySelector("span").innerText=g.classList.contains("hidden")?"â–¾":"â–´";
}

function addItem(id,name,price){
if(!order[id])order[id]={name,price,qty:0};
order[id].qty++;
updateCart();
}

function updateCart(){
cartQty=0;cartTotal=0;
Object.values(order).forEach(i=>{
cartQty+=i.qty;
cartTotal+=i.qty*i.price;
});
cartQtyEl.innerText=cartQty;
cartTotalEl.innerText=cartTotal;
cartBar.classList.toggle("hidden",cartQty===0);
}

function setOrderType(btn,type){
orderType=type;
document.querySelectorAll(".typeBtn").forEach(b=>{
b.classList.remove("bg-red-600","text-white");
b.classList.add("bg-gray-200");
});
btn.classList.add("bg-red-600","text-white");
}

function openSummary(){
overlay.classList.remove("hidden");
let html=`<p class="mb-2"><strong>Order Type:</strong> ${orderType}</p><ul>`;
Object.values(order).forEach(i=>{
html+=`<li>${i.qty}Ã— ${i.name}</li>`;
});
html+=`</ul><p class="mt-3 font-bold">Total: â‚±${cartTotal}</p>`;
summary.innerHTML=html;
}

function closeSummary(){ overlay.classList.add("hidden"); }

function sendToMessenger(){
let msg=`Order Type: ${orderType}%0A`;
Object.values(order).forEach(i=>{
msg+=`${i.qty}x ${i.name}%0A`;
});
msg+=`Total: â‚±${cartTotal}`;
window.open(`https://m.me/${FB_PAGE}?text=${msg}`,"_blank");
}

function showImg(src){
imgView.src=src;
imgModal.classList.remove("hidden");
}

loadMenu();
</script>

</body>
</html>
